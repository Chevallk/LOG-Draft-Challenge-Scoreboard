<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LOG Draft Challenge Scoreboard</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        table { width: 80%; border-collapse: collapse; margin: auto; }
        th, td { border: 1px solid black; padding: 12px; text-align: center; }
        th { background-color: #0073e6; color: white; font-weight: bold; cursor: pointer; }
        tr:nth-child(even) { background-color: #f2f2f2; }
    </style>
</head>
<body>

<h1>2025 LOG Draft Challenge Scoreboard</h1>
<table id="scoreboard">
    <thead>
        <tr id="table-header"></tr>
    </thead>
    <tbody></tbody>
</table>

<script>
    const API_URL = "https://script.google.com/macros/s/AKfycbxBvicwEohuNy72twGhT2r77TZA_XfBa_tUVxmKpQyqLn3dA9zPdgKQk_A8YjLfxtad/exec"; // Replace with actual Web App URL

    function fetchScores() {
        fetch(API_URL)
            .then(response => response.json())
            .then(data => {
                console.log("Raw API Response:", data); // Debugging log

                if (!data || data.error) {
                    document.querySelector("#scoreboard tbody").innerHTML = `<tr><td colspan="7">${data.error || "No valid scores available"}</td></tr>`;
                    return;
                }

                if (data.data && Array.isArray(data.data) && data.data.length > 1) { 
                    console.log("Final processed data:", data.data); // Debugging log
                    updateTable(data.data); 
                } else {
                    document.querySelector("#scoreboard tbody").innerHTML = `<tr><td colspan="7">No scores available</td></tr>`;
                }
            })
            .catch(error => {
                console.error("Error fetching scores:", error);
                document.querySelector("#scoreboard tbody").innerHTML = `<tr><td colspan="7">Error loading scoreboard</td></tr>`;
            });
    }

    function updateTable(data) {
        console.log("Updating table with:", data); // Debugging

        if (!data || data.length < 2) {
            document.querySelector("#scoreboard tbody").innerHTML = `<tr><td colspan="7">No scores available</td></tr>`;
            return;
        }

        const tbody = document.querySelector("#scoreboard tbody");
        tbody.innerHTML = ""; // Clear existing table rows

        let header = data[0]; // Keep the header row intact
        let scores = data.slice(1); // Get the rest of the rows

        scores = scores.filter(row => row.length === header.length); // Ensure row structure matches header

        scores.sort((a, b) => b[b.length - 1] - a[a.length - 1]); // Sort by "Total" column (highest to lowest)

        // Display table header dynamically
        let headerRow = document.querySelector("#table-header");
        headerRow.innerHTML = ""; 
        header.forEach(cell => {
            let th = document.createElement("th");
            th.textContent = cell;
            headerRow.appendChild(th);
        });

        // Process player scores
        scores.forEach(row => {
            let tr = document.createElement("tr");
            row.forEach(cell => {
                let td = document.createElement("td");
                td.textContent = cell || '-';
                tr.appendChild(td);
            });
            tbody.appendChild(tr);
        });
    }

    setInterval(fetchScores, 5000);
    fetchScores();
</script>

</body>
</html>
