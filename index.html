const API_URL = "https://script.google.com/macros/s/AKfycbxBvicwEohuNy72twGhT2r77TZA_XfBa_tUVxmKpQyqLn3dA9zPdgKQk_A8YjLfxtad/exec"; // Add JSONP support

function handleData(data) {
    console.log("Data received from API:", data); // Debugging log

    if (data.error) {
        document.querySelector("#scoreboard tbody").innerHTML = `<tr><td colspan="7">${data.error}</td></tr>`;
        return;
    }

    if (data.data && data.data.length > 1) { 
        console.log("Final processed data:", data.data); // Debugging log
        updateTable(data.data); 
    } else {
        console.error("No valid data received.");
        document.querySelector("#scoreboard tbody").innerHTML = `<tr><td colspan="7">No scores available</td></tr>`;
    }
}

function updateTable(data) {
    console.log("Updating table with:", data); // Debugging

    const tbody = document.querySelector("#scoreboard tbody");
    tbody.innerHTML = ""; // Clear existing table rows

    let header = data.shift(); 
    data.sort((a, b) => b[b.length - 1] - a[a.length - 1]); // Sort by "Total" descending
    data.unshift(header); // Add header back

    data.slice(1).forEach(row => {
        let tr = document.createElement("tr");
        row.forEach(cell => {
            let td = document.createElement("td");
            td.textContent = cell || '-';
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
}

function fetchScores() {
    const script = document.createElement("script");
    script.src = API_URL;
    document.body.appendChild(script);
}

setInterval(fetchScores, 5000);
fetchScores();
